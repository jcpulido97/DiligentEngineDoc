<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Diligent::StateObjectsRegistry class | Diligent Engine</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i,600,600i%7CSource+Code+Pro:400,400i,600" />
  <link rel="stylesheet" href="m-dark+documentation.compiled.css" />
  <link rel="icon" href="favicon-dark.png" type="image/png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#22272e" />
</head>
<body>
<header><nav id="navigation">
  <div class="m-container">
    <div class="m-row">
      <a href="index.html" id="m-navbar-brand" class="m-col-t-8 m-col-m-none m-left-m">Diligent Engine</a>
      <div class="m-col-t-4 m-hide-m m-text-right m-nopadr">
        <a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
          <path id="m-doc-search-icon-path" d="m6 0c-3.31 0-6 2.69-6 6 0 3.31 2.69 6 6 6 1.49 0 2.85-0.541 3.89-1.44-0.0164 0.338 0.147 0.759 0.5 1.15l3.22 3.79c0.552 0.614 1.45 0.665 2 0.115 0.55-0.55 0.499-1.45-0.115-2l-3.79-3.22c-0.392-0.353-0.812-0.515-1.15-0.5 0.895-1.05 1.44-2.41 1.44-3.89 0-3.31-2.69-6-6-6zm0 1.56a4.44 4.44 0 0 1 4.44 4.44 4.44 4.44 0 0 1-4.44 4.44 4.44 4.44 0 0 1-4.44-4.44 4.44 4.44 0 0 1 4.44-4.44z"/>
        </svg></a>
        <a id="m-navbar-show" href="#navigation" title="Show navigation"></a>
        <a id="m-navbar-hide" href="#" title="Hide navigation"></a>
      </div>
      <div id="m-navbar-collapse" class="m-col-t-12 m-show-m m-col-m-none m-right-m">
        <div class="m-row">
          <ol class="m-col-t-6 m-col-m-none">
            <li><a href="pages.html">Pages</a></li>
            <li><a href="namespaces.html">Namespaces</a></li>
          </ol>
          <ol class="m-col-t-6 m-col-m-none" start="3">
            <li><a href="annotated.html">Classes</a></li>
            <li><a href="files.html">Files</a></li>
            <li class="m-show-m"><a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
              <use href="#m-doc-search-icon-path" />
            </svg></a></li>
          </ol>
        </div>
      </div>
    </div>
  </div>
</nav></header>
<main><article>
  <div class="m-container m-container-inflatable">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <h1>
          <div class="m-doc-include m-code m-inverted m-right-m m-text-right"><span class="cp">#include</span> <a class="cpf" href="StateObjectsRegistry_8hpp.html">&lt;Graphics/GraphicsEngine/include/StateObjectsRegistry.hpp&gt;</a></div>
          <div class="m-doc-template">template&lt;typename ResourceDescType&gt;</div>
          <span class="m-breadcrumb"><a href="namespaceDiligent.html">Diligent</a>::<wbr/></span>StateObjectsRegistry <span class="m-thin">class</span>
        </h1>
        <p>Template class implementing state object registry.</p>
        <table class="m-table m-fullwidth m-flat">
          <thead>
            <tr><th colspan="2">Template parameters</th></tr>
          </thead>
          <tbody>
            <tr>
              <td style="width: 1%">ResourceDescType</td>
              <td>- type of the resource description. The type must have operator== and a hash function defined.</td>
            </tr>
          </tbody>
        </table>
        <div class="m-block m-default">
          <h3>Contents</h3>
          <ul>
            <li>
              Reference
              <ul>
                <li><a href="#pub-static-attribs">Public static variables</a></li>
                <li><a href="#pub-methods">Public functions</a></li>
              </ul>
            </li>
          </ul>
        </div>
<aside class="m-note m-default"><h4>Remark</h4><p>The following strategies do not work:</p><ul><li>To store raw pointers and remove the object from the registry in the object&#x27;s destructor. In this case other thread may obtain a reference to the object while it is being deleted. This scenario is possible if one thread has just entered the destructor, but other is executing <a href="classDiligent_1_1StateObjectsRegistry.html#a6643d764bfcb0bc4314a4d4f227dc4a2" class="m-doc">Find()</a> and entered the protection section.</li><li>Strong pointers will cause circular references and result in memory leaks.</li></ul><p>Only weak pointers provide thread-safe solution. The object is either atomically destroyed, so that no other thread can obtain a reference to it through weak pointers. Or it is atomically locked, so that strong reference is obtained. In this case no other thread can destroy the object, because there is at least one strong reference now. Note however that removing the object from the registry in the object&#x27;s destructor may cause a deadlock at the point where <a href="classDiligent_1_1StateObjectsRegistry.html#a6643d764bfcb0bc4314a4d4f227dc4a2" class="m-doc">Find()</a> locks the weak pointer: if other thread has started dtor, the object will be locked by <a href="classDiligent_1_1RefCountedObject.html#ab2904930714c1262bab19044e017a50e" class="m-doc">Diligent::<wbr />RefCountedObject::<wbr />Release()</a>. If after that this thread locks the registry first, it will be waiting for the object to unlock in <a href="classDiligent_1_1RefCntWeakPtr.html#a39b29df7165190c63a48261e9fa2cd14" class="m-doc">Diligent::<wbr />RefCntWeakPtr::<wbr />Lock()</a>, while the dtor thread will be waiting for the registry to unlock.</p></aside>
        <section id="pub-static-attribs">
          <h2><a href="#pub-static-attribs">Public static variables</a></h2>
          <dl class="m-doc">
            <dt id="ae826dc2c8950c7f40d3fe37dfc1d36b7">
              static int <a href="#ae826dc2c8950c7f40d3fe37dfc1d36b7" class="m-doc-self">DeletedObjectsToPurge</a> <span class="m-label m-flat m-primary">constexpr</span>
            </dt>
            <dd>Number of outstanding deleted objects to purge the registry.</dd>
          </dl>
        </section>
        <section id="pub-methods">
          <h2><a href="#pub-methods">Public functions</a></h2>
          <dl class="m-doc">
            <dt>
              <span class="m-doc-wrap-bumper">void <a href="#a24b0050a49d3cb95c7da0540648f4d28" class="m-doc">Add</a>(</span><span class="m-doc-wrap">const ResourceDescType&amp; ObjectDesc,
              <a href="structDiligent_1_1IDeviceObject.html" class="m-doc">IDeviceObject</a>* pObject)</span>
            </dt>
            <dd>Adds a new object to the registry.</dd>
            <dt id="a6643d764bfcb0bc4314a4d4f227dc4a2">
              <span class="m-doc-wrap-bumper">void <a href="#a6643d764bfcb0bc4314a4d4f227dc4a2" class="m-doc-self">Find</a>(</span><span class="m-doc-wrap">const ResourceDescType&amp; Desc,
              <a href="structDiligent_1_1IDeviceObject.html" class="m-doc">IDeviceObject</a>** ppObject)</span>
            </dt>
            <dd>Finds the object in the registry.</dd>
            <dt id="ac4e68d1e015e2ad5941700b4d595a71a">
              <span class="m-doc-wrap-bumper">void <a href="#ac4e68d1e015e2ad5941700b4d595a71a" class="m-doc-self">Purge</a>(</span><span class="m-doc-wrap">)</span>
            </dt>
            <dd>Purges outstanding deleted objects from the registry.</dd>
            <dt id="a65e4d7c1d3e3f1e6519979b7eac0498c">
              <span class="m-doc-wrap-bumper">void <a href="#a65e4d7c1d3e3f1e6519979b7eac0498c" class="m-doc-self">ReportDeletedObject</a>(</span><span class="m-doc-wrap">)</span>
            </dt>
            <dd>Increments the number of outstanding deleted objects. When this number reaches DeletedObjectsToPurge, <a href="classDiligent_1_1StateObjectsRegistry.html#ac4e68d1e015e2ad5941700b4d595a71a" class="m-doc">Purge()</a> will be called.</dd>
          </dl>
        </section>
        <section>
          <h2>Function documentation</h2>
          <section class="m-doc-details" id="a24b0050a49d3cb95c7da0540648f4d28"><div>
            <h3>
              <div class="m-doc-template">
                template&lt;typename ResourceDescType&gt;
              </div>
              <span class="m-doc-wrap-bumper">void Diligent::<wbr />StateObjectsRegistry&lt;ResourceDescType&gt;::<wbr /></span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#a24b0050a49d3cb95c7da0540648f4d28" class="m-doc-self">Add</a>(</span><span class="m-doc-wrap">const ResourceDescType&amp; ObjectDesc,
              <a href="structDiligent_1_1IDeviceObject.html" class="m-doc">IDeviceObject</a>* pObject)</span></span>
            </h3>
            <p>Adds a new object to the registry.</p>
            <table class="m-table m-fullwidth m-flat">
              <thead>
                <tr><th colspan="2">Parameters</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td style="width: 1%">ObjectDesc&nbsp;<span class="m-label m-flat m-info">in</span></td>
                  <td>- object description.</td>
                </tr>
                <tr>
                  <td>pObject&nbsp;<span class="m-label m-flat m-info">in</span></td>
                  <td>- pointer to the object.</td>
                </tr>
              </tbody>
            </table>
<p>Besides adding a new object, the function also checks the number of outstanding deleted objects and calls <a href="classDiligent_1_1StateObjectsRegistry.html#ac4e68d1e015e2ad5941700b4d595a71a" class="m-doc">Purge()</a> if the number has reached the threshold value DeletedObjectsToPurge. Creating a state object is assumed to be an expensive operation and should be performed during the initialization. Occasional purge operations should not add significant cost to it.</p>
          </div></section>
        </section>
      </div>
    </div>
  </div>
</article></main>
<div class="m-doc-search" id="search">
  <a href="#!" onclick="return hideSearch()"></a>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-m-8 m-push-m-2">
        <div class="m-doc-search-header m-text m-small">
          <div><span class="m-label m-default">Tab</span> / <span class="m-label m-default">T</span> to search, <span class="m-label m-default">Esc</span> to close</div>
          <div id="search-symbolcount">&hellip;</div>
        </div>
        <div class="m-doc-search-content">
          <form>
            <input type="search" name="q" id="search-input" placeholder="Loading &hellip;" disabled="disabled" autofocus="autofocus" autocomplete="off" spellcheck="false" />
          </form>
          <noscript class="m-text m-danger m-text-center">Unlike everything else in the docs, the search functionality <em>requires</em> JavaScript.</noscript>
          <div id="search-help" class="m-text m-dim m-text-center">
            <p class="m-noindent">Search for symbols, directories, files, pages or
            modules. You can omit any prefix from the symbol or file path; adding a
            <code>:</code> or <code>/</code> suffix lists all members of given symbol or
            directory.</p>
            <p class="m-noindent">Use <span class="m-label m-dim">&darr;</span>
            / <span class="m-label m-dim">&uarr;</span> to navigate through the list,
            <span class="m-label m-dim">Enter</span> to go.
            <span class="m-label m-dim">Tab</span> autocompletes common prefix, you can
            copy a link to the result using <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">L</span> while <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">M</span> produces a Markdown link.</p>
          </div>
          <div id="search-notfound" class="m-text m-warning m-text-center">Sorry, nothing was found.</div>
          <ul id="search-results"></ul>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="search-v1.js"></script>
<script src="searchdata-v1.js" async="async"></script>
<footer><nav>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <p>Diligent Engine. Created with <a href="https://doxygen.org/">Doxygen</a> 1.8.17 and <a href="https://mcss.mosra.cz/">m.css</a>.</p>
      </div>
    </div>
  </div>
</nav></footer>
</body>
</html>
